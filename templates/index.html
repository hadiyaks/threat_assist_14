<!DOCTYPE html>
<html>
<head>
    <title>SentinelLink</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>

<div class="app-container">

    <!-- SIDEBAR -->
    <div class="sidebar">
        <div class="sidebar-header">
            ☰ Sentinel Chats
        </div>

        <div class="search-box">
            <input type="text" placeholder="Search">
        </div>

        <div class="chat-list">
            <div class="chat-item active">Cyber Incident</div>
            <div class="chat-item">Phishing Case</div>
            <div class="chat-item">Malware Report</div>
        </div>

        <div class="user-info">
            hadiya@sentinel.com
        </div>
    </div>

    <!-- MAIN CHAT AREA -->
    <div class="main">

        <div class="chat-header">
            <div class="chathead" >Describe your issue...</div>
        </div>

        <div id="chat-box" class="chat-box"></div>

        <div class="input-area">
            <input type="text" id="message" placeholder="Type your issue...">
            <button onclick="sendMessage()">↑</button>
        </div>

    </div>

</div>

<script>
function addMessage(content, className) {
    const chatBox = document.getElementById("chat-box");
    const div = document.createElement("div");
    div.className = className;
    div.innerHTML = content;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage() {
    let message = document.getElementById("message").value;
    let country = document.getElementById("country").value;

    if(message.trim() === "") return;

    addMessage(message, "user-msg");

    fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: message, country: country })
    })
    .then(res => res.json())
    .then(data => {

        let severityColor = "#22c55e";
        if(data.severity === "High") severityColor = "#ef4444";
        if(data.severity === "Medium") severityColor = "#f59e0b";

        let responseHTML = `
            <div class="bot-title" style="color:${severityColor}">
                ${data.threat.toUpperCase()} (${data.severity})
            </div>
            <div>Confidence: ${data.confidence}</div>
            <ul>
                ${data.steps.map(step => `<li>${step}</li>`).join("")}
            </ul>
            <div class="report-link">
                <a href="${data.report_url}" target="_blank">
                    Report to ${data.report_name}
                </a>
            </div>
        `;

        addMessage(responseHTML, "bot-msg");
    });

    document.getElementById("message").value = "";
}
</script>

</body>
</html>
